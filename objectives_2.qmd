# Objective 2: Consumer Concerns

**Goal:** Understand the friction points—regulatory, legal, and psychological—that could slow down AV scaling.

```{r}
#| label: load-obj2
#| message: false
#| warning: false
#| include: false
library(tidyverse)
library(gtsummary)
library(gt)
library(broom)
library(ggthemr)
library(tidytext)
library(wordcloud)
library(DT)
library(plotly)

# Load Data
df <- read.csv("./data/AVsurvey.csv")

# Set theme
theme_gtsummary_journal(journal = "jama")
ggthemr("fresh")

```

## The Regulatory Mandate

**Question:** *Who does the public trust to oversee this technology?*

```{r}
#| label: fig-reg
#| echo: false
#| message: false
#| warning: false
#| fig-align: center
#| fig-cap: Preferred Regulatory Body for Autonomous Vehicles


# Prepare Data
reg_counts <- df %>% 
  count(opinions) %>% 
  mutate(opinions = reorder(opinions, -n))

# Plot
p <- ggplot(reg_counts, aes(x = opinions, y = n, fill = opinions)) +
  geom_bar(stat = "identity", width = 0.7, alpha = 0.9) +
  labs(title = "Preferred Regulatory Body", x = "", y = "Count") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14),
        axis.text.x = element_text(angle = 45, hjust = 1))

# Conditional Output: Interactive for HTML, Static for PDF/DOCX
if (knitr::is_html_output()) {
  ggplotly(p)
} else {
  p
}
```
```{r}
#| label: tab-reg
#| echo: false
#| message: false
#| warning: false
#| tab-align: center
#| tab-cap: chi-square-test-regulation
# --- Statistical Test: Chi-Square Goodness of Fit ---
chisq.test(reg_counts$n) %>%
  tidy() %>%
  select(statistic, p.value, parameter, method) %>%
  gt() %>%
  tab_header(title = "Chi-Square Test: Uniformity of Preference") %>%
  fmt_number(columns = c(statistic), decimals = 2) %>%
  fmt_number(columns = p.value, decimals = 3) %>%
  cols_label(statistic = "Chi-Squared", p.value = "P-Value", parameter = "df")
```

**Analysis:** A strong preference for Government regulation implies that "Moving fast and breaking things" is a dangerous strategy. Lobbying and compliance will be key. Here , legitimacy trumps speed. The AV firm should embrace regulation as a trust-building mechanism rather than resist it. Also, the significant Chi-Square result indicates that preferences are not uniformly distributed, highlighting a clear public inclination towards government oversight.

## Blame Attribution

**Question:** *Is the individual coder liable?*

**Question:** *Is the corporation liable?*

**Question:** *Is the regulator liable?*

```{r}
#| label: blame-analysis
#| echo: false
#| message: false
#| warning: false
#| fig-align: center
#| fig-cap: Blame Attribution Across Entities
# 1. Scientific Plot with Error Bars
# Reshape for Plotting
blame_long <- df %>%
  select(participant_id, acc_blame_programmer, acc_blame_company, acc_blame_govt) %>%
  pivot_longer(cols = starts_with("acc_blame"), 
               names_to = "Entity_Code", 
               values_to = "Blame_Score") %>%
  mutate(Entity = case_when(
    Entity_Code == "acc_blame_programmer" ~ "Programmer",
    Entity_Code == "acc_blame_company" ~ "AV Company",
    Entity_Code == "acc_blame_govt" ~ "Government"
  ))

# Calculate Stats for Plot
blame_summary_plot <- blame_long %>%
  group_by(Entity) %>%
  summarise(
    Mean_Blame = mean(Blame_Score, na.rm = TRUE),
    SE = sd(Blame_Score, na.rm = TRUE) / sqrt(n()),
    CI_Lower = Mean_Blame - (1.96 * SE),
    CI_Upper = Mean_Blame + (1.96 * SE)
  )

# Plot
p_blame <- ggplot(blame_summary_plot, aes(x = reorder(Entity, -Mean_Blame), y = Mean_Blame, fill = Entity)) +
  geom_bar(stat = "identity", width = 0.6, alpha = 0.8) +
  geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.2, size = 0.8) +
  labs(title = "Average Blame Attribution (with 95% CI)", 
       y = "Mean Blame Score (0-100)", 
       x = "Entity") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14))

# Conditional Output: Interactive for HTML, Static for PDF/DOCX
if (knitr::is_html_output()) {
  ggplotly(p_blame)
} else {
  p_blame
}
```
```{r}
#| label: tab-reg-blame
#| echo: false
#| message: false
#| warning: false
#| tab-align: center
#| tab-cap: Summary-Statistics-Blame
# 2. Statistical Summary Table
df %>%
  select(acc_blame_programmer, acc_blame_company, acc_blame_govt) %>%
  tbl_summary(
    label = list(
      acc_blame_programmer ~ "Blame: Programmer",
      acc_blame_company ~ "Blame: AV Company",
      acc_blame_govt ~ "Blame: Government"
    ),
    statistic = all_continuous() ~ "{mean} ({sd})",
    digits = all_continuous() ~ 1
  ) %>%
  modify_header(label = "**Entity**", stat_0 = "**Mean Score (SD)**") %>%
  modify_caption("**Table: Descriptive Statistics for Blame Attribution**")
```

**Analysis:** The public overwhelmingly blames the AV Company, indicating that corporate responsibility will be a central issue in liability discussions. This suggests that AV firms must invest heavily in insurance and risk mitigation strategies. The coder and government are seen as less culpable, which may influence how legal frameworks are structured around AV incidents.

## Qualitative Risk Analysis

**Question:** *What specific fears do consumers voice in open-ended responses?*

```{r}
#| label: risks-text
#| echo: false
#| message: false
#| warning: false

# 1. Filter and Clean Data
risks <- df %>% 
  select(risks_oe) %>% 
  filter(risks_oe != "")

# 2. Tokenize and Count Frequencies
risk_tokens <- risks %>%
  unnest_tokens(word, risks_oe) %>%
  anti_join(stop_words) %>%
  count(word, sort = TRUE) %>%
  filter(n > 5) # Filter for words appearing more than 5 times

# 3. Visualize Top Concerns
p_risks <- ggplot(head(risk_tokens, 15), aes(x = reorder(word, n), y = n, fill = n)) +
  geom_col() +
  coord_flip() +
  scale_fill_gradientn(colors = c("lightblue", "blue", "red")) + 
  labs(title = "Top 15 Common Terms in Risk Responses", x = "Term", y = "Frequency") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14))

# Conditional Output: Interactive for HTML, Static for PDF/DOCX
if (knitr::is_html_output()) {
  ggplotly(p_risks)
} else {
  p_risks
}

# 4. Show Data Table (Only in HTML)
if (knitr::is_html_output()) {
  datatable(head(risks, 50), 
            options = list(pageLength = 5, dom = 'tip'), 
            caption = "Consumer Risk Voices (Scrollable)")
}

```

**Analysis:** Common themes include fears of hacking, software glitches, and loss of control. Addressing these concerns through robust cybersecurity measures and transparent communication will be essential for consumer acceptance. Safety is not just a technical issue but a psychological one. Thus, marketing strategies should directly tackle these fears to build trust.
