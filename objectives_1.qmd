# Objective 1: Strategy for Scaling

**Goal:** Determine a strategy for scaling autonomous vehicles by analyzing consumer Willingness to Pay (WTP) and confidence drivers.

```{r}
#| label: load-obj1
#| echo: false
#| warning: false
#| message: false
library(tidyverse)
library(plotly)
library(ggpubr)
library(rstatix)
library(gtsummary) 
library(gt)
library(broom)
library(ggthemr) # For plot themes


# Load Data
df <- read.csv("./data/AVsurvey.csv")

# Re-apply factor levels for ordinal variables
df$conf_safe <- factor(df$conf_safe, levels = c("Not very confident", "Somewhat confident", "Very confident", "Extremely confident"))
df$conf_right <- factor(df$conf_right, levels = c("Not very confident", "Somewhat confident", "Very confident", "Extremely confident"))

# Set gtsummary theme to a scientific journal standard (JAMA)
theme_gtsummary_journal(journal = "jama")

# Apply ggthemr 'flat' theme for a consistent, scientific color profile
ggthemr("fresh")
```

## The Pricing Gap: Human vs. AV

**Question**: Does the market demand a discount for AVs, or will they pay a premium?

```{r}
#| label: fig-wtp-comp
#| message: false
#| warning: false

# Prepare Data
df_long <- df %>%
  select(participant_id, maxfare_1, maxfare_2) %>%
  pivot_longer(cols = starts_with("maxfare"), names_to = "Mode_Code", values_to = "WTP") %>%
  mutate(Mode = ifelse(Mode_Code == "maxfare_1", "Private (Human)", "Private (AV)"))

# Plot (ggthemr handles colors and theme)
p <- ggplot(df_long, aes(x = Mode, y = WTP, fill = Mode)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA) +
  labs(title = "WTP Comparison: Human vs. Autonomous", 
       y = "Max Fare ($) for 10 min ride",
       x = "Transport Mode") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14))

ggplotly(p)

# --- Statistical Test: Paired T-Test (Formatted with gt) ---
t.test(df$maxfare_1, df$maxfare_2, paired = TRUE) %>% 
  tidy() %>% 
  select(estimate, statistic, p.value, conf.low, conf.high) %>%
  gt() %>%
  tab_header(title = "Paired T-Test: Private Human vs. AV") %>%
  fmt_number(columns = c(estimate, statistic, conf.low, conf.high), decimals = 2) %>%
  fmt_number(columns = p.value, decimals = 3) %>%
  cols_label(estimate = "Mean Diff", statistic = "t-statistic", p.value = "P-Value", 
             conf.low = "95% CI Lower", conf.high = "95% CI Upper")
```

**Analysis**: If the mean WTP for AVs is lower, the strategy must initially focus on cost-leadership or subsidization to drive adoption.

## Private vs. Shared Dynamics

**Question:** *How does the WTP degradation compare when moving from Private to Shared?*

```{r}
#| label: fig-wtp-shared
#| warning: false
#| message: false

# Prepare Data
df_shared <- df %>%
  select(participant_id, maxfare_3, maxfare_4) %>%
  pivot_longer(cols = starts_with("maxfare"), names_to = "Mode_Code", values_to = "WTP") %>%
  mutate(Mode = ifelse(Mode_Code == "maxfare_3", "Shared (Human)", "Shared (AV)"))

# Plot
p2 <- ggplot(df_shared, aes(x = Mode, y = WTP, fill = Mode)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "WTP Comparison: Shared Rides", 
       y = "Max Fare ($)",
       x = "Transport Mode") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14))

ggplotly(p2)

# --- Statistical Test: Paired T-Test (Formatted with gt) ---
t.test(df$maxfare_3, df$maxfare_4, paired = TRUE) %>% 
  tidy() %>% 
  select(estimate, statistic, p.value, conf.low, conf.high) %>%
  gt() %>%
  tab_header(title = "Paired T-Test: Shared Human vs. AV") %>%
  fmt_number(columns = c(estimate, statistic, conf.low, conf.high), decimals = 2) %>%
  fmt_number(columns = p.value, decimals = 3) %>%
  cols_label(estimate = "Mean Diff", statistic = "t-statistic", p.value = "P-Value", 
             conf.low = "95% CI Lower", conf.high = "95% CI Upper")
```

## The Trust Premium (Safety)

**Question:** *Can we charge more if consumers trust the safety technology?*

```{r}
#| label: fig-conf-safe
#| warning: false
#| message: false

# Plot
p3 <- ggplot(df, aes(x = conf_safe, y = maxfare_2, fill = conf_safe)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "Impact of Safety Confidence on WTP", 
       x = "Confidence Level", 
       y = "WTP ($)") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14))

ggplotly(p3)

# --- Statistical Test: ANOVA via gtsummary ---
df %>%
  select(maxfare_2, conf_safe) %>%
  tbl_summary(
    by = conf_safe,
    label = list(maxfare_2 ~ "WTP for Private AV ($)"),
    statistic = all_continuous() ~ "{mean} ({sd})",
    digits = all_continuous() ~ 2
  ) %>%
  add_p(test = maxfare_2 ~ "aov") %>% 
  add_n() %>% 
  modify_header(label = "**Variable**") %>%
  bold_labels()
```

*Analysis:* A significant ANOVA suggests that marketing spend on safety demonstration is directly convertible to higher fares.

## The Ethics Premium

**Question:** *Does trust in ethical algorithms drive value as much as physical safety?*

```{r}
#| label: fig-conf-ethics
#| warning: false

# Plot
p4 <- ggplot(df, aes(x = conf_right, y = maxfare_2, fill = conf_right)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "Impact of Ethical Confidence on WTP", 
       x = "Ethical Confidence", 
       y = "WTP ($)") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14))

ggplotly(p4)
```

## Strategic Synthesis for Scaling

Based on the data above:

1. **Pricing:** If WTP is lower for AVs, enter the market with a penetration pricing strategy.

2. **Marketing:** Prioritize "Safety" messaging over "Ethics" if the ANOVA F-value for safety is higher.

3. **Product Mix:** If the gap between Private AV and Shared AV is small, push Shared AVs to maximize fleet revenue per mile.
